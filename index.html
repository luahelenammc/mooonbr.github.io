<!DOCTYPE html>
<html lang="pt-BR">
<head>
   <link rel="stylesheet" type="text/css" href="/common.css">
  <meta charset="UTF-8" />
  <title>Portal da Moon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- jQuery para o script original do template -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <style>
    :root {
      --azul: #245edb;
      --azul-medio: #3f8cf3;
      --azul-claro: #0c8dea;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #000;
      overflow-y: auto;
    }

    #windowsXP {
      display: flex;
      width: 100vw;
      min-height: 100vh;
    }

    .area-de-trabalho {
      position: relative;
      flex: 1;
      width: 100vw;
      min-height: calc(100vh - 50px);
      background: url("https://images2.alphacoders.com/941/941898.jpg") center/cover no-repeat;
      overflow: hidden;
    }

    /* Ícones do desktop - base desktop */
    .desktop-icon {
      position: absolute;
      width: 110px;
      height: 135px;
      padding: 12px 6px 4px;
      text-align: center;
      overflow: hidden;
      z-index: 1;
      cursor: default;
      user-select: none;
    }

    .desktop-icon img {
      max-width: 68px;
      max-height: 68px;
      width: auto;
      height: auto;
      display: block;
      margin: 0 auto 4px;
      box-shadow: none;
      pointer-events: none;
    }

    .desktop-icon span {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      white-space: normal;
      color: #fff;
      font-size: 13px;
      text-shadow: 2px 2px 8px #000;
    }

    .desktop-icon.selected span {
      background: #004E98;
    }

    /* Barra de tarefas */
    .barra-de-tarefas {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100vw;
      height: 50px;
      display: flex;
      justify-content: space-between;
      align-items: stretch;
      background: linear-gradient(
        to bottom,
        var(--azul) 0%,
        var(--azul-claro) 9%,
        var(--azul) 18%,
        var(--azul) 92%,
        #333 100%
      );
      z-index: 995;
    }

    #iniciar {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 170px;
      padding: 0 16px;
      border: none;
      margin-right: 12px;
      background: linear-gradient(
        to bottom,
        #3d973d 0%,
        #6faf72 9%,
        #3d973d 18%,
        #3d973d 92%,
        #666 100%
      );
      border-top-right-radius: 15px;
      border-bottom-right-radius: 15px;
      cursor: pointer;
      color: #fff;
      font-size: 1.4rem;
      font-weight: bold;
      text-shadow: 2px 2px 8px #003d00;
    }

    #iniciar img {
      width: 26px;
      height: 26px;
      margin-right: 8px;
    }

    #iniciar:hover {
      background: linear-gradient(
        to bottom,
        #3d973d 0%,
        #6faf72 9%,
        #3d973d 18%,
        #37d437 92%,
        #666 100%
      );
    }

    #iniciar.active {
      box-shadow: inset 0 6px 6px -6px #000;
    }

    .programas-abertos {
      flex: 1;
      display: flex;
      align-items: center;
      overflow: hidden;
    }

    .area-de-notificacao {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 230px;
      background: linear-gradient(
        to bottom,
        #0fadf4 0%,
        #0fadf4 9%,
        #108ae5 18%,
        #108ae5 92%,
        #666 100%
      );
      padding: 0 8px;
    }

    .tray-icons {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-left: 6px;
    }

    .tray-icons img {
      width: 20px;
      height: 20px;
    }

    #relogio {
      margin-right: 4px;
      color: #fff;
      font-size: 15px;
      font-weight: bold;
    }

    /* Menu Iniciar */

    #menuIniciar {
      position: fixed;
      left: 0;
      bottom: 50px;
      width: 500px;
      height: 560px;
      display: none;
      flex-direction: column;
      background: #fff;
      border-top-right-radius: 10px;
      border-right: 3px solid var(--azul);
      z-index: 999;
      box-shadow: 0 0 18px rgba(0,0,0,0.6);
      overflow: hidden;
    }

    #menuIniciar.active {
      display: flex;
    }

    .topoIniciar {
      display: flex;
      align-items: center;
      height: 90px;
      background: linear-gradient(
        to bottom,
        var(--azul) 0%,
        var(--azul-claro) 9%,
        var(--azul) 18%,
        var(--azul) 92%,
        var(--azul) 100%
      );
    }

    .avatarIniciar {
      width: 70px;
      height: 70px;
      margin-left: 16px;
      border-radius: 10px;
      background: #fff url("/images/moonvrjan26.webp") center/cover no-repeat;
    }

    .userName {
      margin-left: 18px;
      color: #fff;
      font-size: 20px;
    }

    .mioloIniciar {
      display: flex;
      flex: 1;
      padding: 8px 0;
    }

    .col {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    .tituloColuna {
      padding: 4px 10px;
      font-size: 12px;
      color: #555;
      font-weight: bold;
      border-bottom: 1px solid #ccc;
      margin-bottom: 2px;
    }

    .itemIniciar {
      display: flex;
      align-items: center;
      padding: 6px 12px;
      cursor: default;
    }

    .itemIniciar img {
      width: 26px;
      height: 26px;
      margin-right: 8px;
    }

    .itemIniciar span {
      font-size: 13px;
      color: #666;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .itemIniciar span strong {
      color: #000;
    }

    .itemIniciar:hover {
      background: var(--azul-claro);
    }

    .itemIniciar:hover span,
    .itemIniciar:hover span strong {
      color: #fff;
    }

    .footerIniciar {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      height: 60px;
      padding-right: 16px;
      background: linear-gradient(
        to bottom,
        var(--azul) 0%,
        var(--azul-claro) 9%,
        var(--azul) 18%,
        var(--azul) 92%,
        var(--azul) 100%
      );
      color: #fff;
      font-size: 13px;
      gap: 16px;
    }

    .footerIniciar span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: default;
    }

    .footerIniciar img {
      width: 18px;
      height: 18px;
    }

    /* MOBILE */
    
    /* Clippy labels e Clippy destaque */
    .desktop-icon .clippy-label {
      position: absolute;
      right: -4px;
      top: -4px;
      width: 52px;      /* maior que antes, visível no desktop */
      height: auto;
      pointer-events: none;
      z-index: 2;
    }

    #clippy-fun {
      position: absolute;
      right: 24px;
      bottom: 74px;     /* acima da barra de tarefas */
      z-index: 3;
      pointer-events: none;
    }

    #clippy-fun img {
      display: block;
      width: 200px;     /* ~2x um ícone de desktop */
      height: auto;
    }

    @media (max-width: 900px), (pointer: coarse) {
      .desktop-icon .clippy-label {
        width: 60px;
        right: -2px;
        top: -2px;
      }

      #clippy-fun {
        right: 10px;
        bottom: 70px;
      }

      #clippy-fun img {
        width: 120px;   /* ~1.5x ícone mobile */
      }
    }

@media (max-width: 900px), (pointer: coarse) {
      .barra-de-tarefas {
        height: 56px;
      }

      .area-de-trabalho {
        min-height: calc(100vh - 56px);
        background-attachment: scroll;
      }

      .desktop-icon {
        width: 135px;
        height: 155px;
        padding: 12px 6px 4px;
      }

      .desktop-icon img {
        max-width: 88px;
        max-height: 88px;
      }

      .desktop-icon span {
        font-size: 17px;
      }

      #menuIniciar {
        width: min(94vw, 520px);
        height: min(78vh, 720px);
        bottom: 60px;
      }

      .avatarIniciar { width: 82px; height: 82px; }
      .userName { font-size: 22px; }
      .itemIniciar { height: 72px; padding: 14px; }
      .itemIniciar img { width: 48px; height: 48px; }
      .itemIniciar span { font-size: 17px; }

      #iniciar { width: 190px; font-size: 1.7rem; }
      #relogio { font-size: 1.1rem; }
    }
  
    /* Start menu - itens com link */
    #menuIniciar .itemIniciar[data-link]{
      cursor: pointer;
    }
    #menuIniciar .itemIniciar[data-link]:hover{
      background: rgba(255,255,255,0.25);
    }
</style>
</head>
<body>
  <div id="windowsXP">
    <div class="area-de-trabalho" id="desktopArea">
      <!-- Ícones via JS -->
      <div id="clippy-fun"></div>


      <div id="menuIniciar">
        <div class="topoIniciar">
          <div class="avatarIniciar"></div>
          <div class="userName">Moon</div>
        </div>

        <div class="mioloIniciar">
          <div class="col">
            <div class="tituloColuna">Programas</div>

            <div class="itemIniciar">
              <img src="https://files.tecnoblog.net/wp-content/uploads/2009/03/internet-explorer-8.png" alt="IE" />
              <span><strong>Internet</strong><br/>Internet Explorer</span>
            </div>
            <div class="itemIniciar">
              <img src="https://icons.iconarchive.com/icons/hopstarter/software/256/Windows-Media-Player-icon.png" alt="WMP" />
              <span><strong>Windows Media Player</strong></span>
            </div>
            <div class="itemIniciar">
              <img src="https://www.pngkit.com/png/full/341-3415120_msn-logo-png.png" alt="MSN" />
              <span><strong>Windows Messenger</strong></span>
            </div>
          </div>

          <div class="col">
            <div class="tituloColuna">Links</div>

            <div id="startLinks"></div>

            </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    
    const CLIPPY_LABELS = {
      reading: "/images/clippy/reading.gif",
      music: "/images/clippy/music.gif"
    };

    const CLIPPY_FUN = [
      "/images/clippy/fun/bicicle.gif",
      "/images/clippy/fun/check.gif",
      "/images/clippy/fun/coçando cabeça.gif",
      "/images/clippy/fun/luneta.gif",
      "/images/clippy/fun/melting down.gif",
      "/images/clippy/fun/toc toc.gif",
      "/images/clippy/fun/pretendtodie.gif",
      "/images/clippy/fun/box.gif",
      "/images/clippy/fun/atom.gif"
    ];

    const DESKTOP_ICONS = [
      { id: "blog_nostalgia", label: "BLOG NOSTALGIA",        img: "/images/snes.png",                 link: "https://nostalgia.mooon.com.br",                                         row: 0, col: 0, clippy: "reading" },
      { id: "habbo",          label: "Habbo Hotel",           img: "/images/habbo hc.fw.png",         link: "https://nostalgia.mooon.com.br/2025/12/habbo-hotel.html",              row: 0, col: 1, clippy: "reading" },
      { id: "ps1",            label: "Playstation 1",         img: "/images/ps1.png",                  link: "https://nostalgia.mooon.com.br/search/label/PlayStation%201",          row: 0, col: 2, clippy: "reading" },
      { id: "ps2",            label: "Playstation 2",         img: "/images/ps2.png",                  link: "https://nostalgia.mooon.com.br/search/label/PlayStation%202",          row: 0, col: 3, clippy: "reading" },
      { id: "snes",           label: "Super Nintendo",        img: "/images/supern.png",               link: "https://nostalgia.mooon.com.br/search/label/Super%20Nintendo",         row: 0, col: 4, clippy: "reading" },

      { id: "instagram",      label: "Instagram",             img: "/images/insta.png",                link: "https://instagram.com/mooon.br",                                         row: 1, col: 0 },
      { id: "tiktok",         label: "Tiktok",                img: "/images/tiktok.png",               link: "https://tiktok.com/@mooon.br",                                           row: 1, col: 1 },
      { id: "twitch",         label: "Twitch",                img: "/images/twitch.png",               link: "https://twitch.tv/mooonbr",                                              row: 1, col: 2 },
      { id: "youtube",        label: "Youtube",               img: "/images/youtube.png",              link: "https://youtube.com/channel/UCst0jXP1CRb-_1S00F1NMgQ",                 row: 1, col: 3 },

      { id: "playlists",      label: "Playlists nostálgicas", img: "/images/ringtone.png",            link: "/musicas.html",                                                          row: 2, col: 0, clippy: "music" },
      { id: "musicas_ia",     label: "Músicas geradas por IA", img: "/images/music_icon_trophy.png",  link: "/aimusic.html",                                                          row: 2, col: 1, clippy: "music" },
      { id: "moon_tv",        label: "Moon TV",               img: "/images/series.png",               link: "/tv/index.html",                                                         row: 2, col: 2 },
      { id: "pokemon",        label: "Meus Pokémon",          img: "/images/pokeshelf.png",            link: "/pokemon.html",                                                          row: 2, col: 3 }
    ];

    // Quais ícones entram no "Links" do Menu Iniciar
    const START_MENU_LINK_IDS = [
      "blog_nostalgia",
      "instagram",
      "tiktok",
      "twitch",
      "youtube"
    ];

    function renderStartMenuLinks() {
      const container = document.getElementById("startLinks");
      if (!container) return;

      // limpa
      container.innerHTML = "";

      // monta a partir do DESKTOP_ICONS (fonte única de verdade)
      const byId = Object.fromEntries(DESKTOP_ICONS.map(i => [i.id, i]));

      for (const id of START_MENU_LINK_IDS) {
        const icon = byId[id];
        if (!icon) continue;

        const item = document.createElement("div");
        item.className = "itemIniciar";
        item.setAttribute("data-link", icon.link || "");
        item.innerHTML = `
          <img src="${icon.img}" alt="${icon.label}">
          <span><strong>${icon.label}</strong></span>
        `;
        container.appendChild(item);
      }
    }



    function isMobile() {
      return window.matchMedia("(max-width: 900px)").matches ||
             window.matchMedia("(pointer: coarse)").matches;
    }

    function renderDesktopIcons() {
      const desktop = document.getElementById("desktopArea");
      if (!desktop) return;

      desktop.querySelectorAll(".desktop-icon").forEach(el => el.remove());

      const mobile = isMobile();
      const rect = desktop.getBoundingClientRect();
      const availW = rect.width || window.innerWidth || 360;
      const availH = rect.height || window.innerHeight || 640;

      let iconW = mobile ? 135 : 110;
      let iconH = mobile ? 155 : 135;

      if (!mobile) {
        const marginX = 26;
        const marginY = 40;
        const stepX = 120;
        const stepY = 155;

        let maxBottom = 0;

        DESKTOP_ICONS.forEach(icon => {
          const el = document.createElement("div");
          el.className = "desktop-icon";
          el.id = icon.id;
          el.innerHTML = `<img src="${icon.img}" alt="${icon.label}"><span>${icon.label}</span>`;
          el.dataset.link = icon.link || "";

          const left = marginX + (icon.col || 0) * stepX;
          const top  = marginY + (icon.row || 0) * stepY;

          el.style.left = left + "px";
          el.style.top  = top + "px";

          desktop.appendChild(el);

          const bottom = top + iconH;
          if (bottom > maxBottom) maxBottom = bottom;
        });

        const minHeight = Math.max(availH, maxBottom + 40);
        desktop.style.height = minHeight + "px";
        document.getElementById("windowsXP").style.minHeight = minHeight + "px";
        return;
      }

      // MOBILE: reempacota em grid
      const marginX = 12;
      const marginY = 16;

      // tenta 3 colunas; se ficar apertado, cai pra 2
      let cols = 3;
      if (availW < (cols * iconW + (cols + 1) * marginX)) {
        cols = 2;
      }

      const total = DESKTOP_ICONS.length;
      const rows = Math.max(1, Math.ceil(total / cols));

      let stepX = (availW - marginX * 2) / cols;
      stepX = Math.max(iconW + 4, stepX);

      let stepY = iconH + 16;
      const usedH = rows * stepY + marginY * 2;
      if (usedH > availH) {
        stepY = Math.floor((availH - marginY * 2) / rows);
        stepY = Math.max(iconH + 4, stepY);
      }

      let maxBottom = 0;

      for (let i = 0; i < total; i++) {
        const icon = DESKTOP_ICONS[i];
        const row = Math.floor(i / cols);
        const col = i % cols;

        const el = document.createElement("div");
        el.className = "desktop-icon";
        el.id = icon.id;
        el.innerHTML = `<img src="${icon.img}" alt="${icon.label}"><span>${icon.label}</span>`;
        el.dataset.link = icon.link || "";

        const slotLeft = marginX + col * stepX;
        const left = slotLeft + (stepX - iconW) / 2;
        const top  = marginY + row * stepY;

        el.style.left = left + "px";
        el.style.top  = top + "px";

        desktop.appendChild(el);

        const bottom = top + iconH;
        if (bottom > maxBottom) maxBottom = bottom;
      }

      const minHeight = Math.max(availH, maxBottom + 40);
      desktop.style.height = minHeight + "px";
      document.getElementById("windowsXP").style.minHeight = minHeight + "px";
    }

    function applyClippyLabels() {
      if (typeof CLIPPY_LABELS === "undefined") return;

      DESKTOP_ICONS.forEach(icon => {
        if (!icon.clippy) return;
        const el = document.getElementById(icon.id);
        if (!el) return;

        const existing = el.querySelector(".clippy-label");
        if (existing) existing.remove();

        const src = CLIPPY_LABELS[icon.clippy];
        if (!src) return;

        const img = document.createElement("img");
        img.className = "clippy-label";
        img.src = src;
        img.alt = "Clippy";
        el.appendChild(img);
      });
    }

    function renderClippyFun() {
      if (typeof CLIPPY_FUN === "undefined" || !CLIPPY_FUN.length) return;

      const desktop = document.getElementById("desktopArea");
      const box = document.getElementById("clippy-fun");
      if (!desktop || !box) return;

      const idx = Math.floor(Math.random() * CLIPPY_FUN.length);
      const src = CLIPPY_FUN[idx];
      if (!src) {
        box.innerHTML = "";
        return;
      }

      box.innerHTML = "";
      const img = document.createElement("img");
      img.src = src;
      img.alt = "Clippy animado";
      box.appendChild(img);
    }


    function atualizarRelogio() {
      const rel = document.getElementById("relogio");
      if (!rel) return;
      const agora = new Date();
      const hh = String(agora.getHours()).padStart(2, "0");
      const mm = String(agora.getMinutes()).padStart(2, "0");
      rel.textContent = hh + ":" + mm;
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderDesktopIcons();
      renderStartMenuLinks();
      applyClippyLabels();
      renderClippyFun();
      if (window.jQuery && $.fn.draggable) {
        $(".desktop-icon").draggable();
      }
      atualizarRelogio();
      setInterval(atualizarRelogio, 30000);

      window.addEventListener("resize", () => {
        renderDesktopIcons();
        renderStartMenuLinks();
        applyClippyLabels();
        renderClippyFun();
        if (window.jQuery && $.fn.draggable) {
          $(".desktop-icon").draggable();
        }
      }, { passive: true });
      window.addEventListener("orientationchange", () => {
        renderDesktopIcons();
        renderStartMenuLinks();
        applyClippyLabels();
        renderClippyFun();
        if (window.jQuery && $.fn.draggable) {
          $(".desktop-icon").draggable();
        }
      }, { passive: true });

      const btnIniciar = document.getElementById("iniciar");
      const menuIniciar = document.getElementById("menuIniciar");

      btnIniciar.addEventListener("click", ev => {
        ev.stopPropagation();
        const ativo = menuIniciar.classList.toggle("active");
        btnIniciar.classList.toggle("active", ativo);
      });

      document.addEventListener("click", ev => {
        if (!menuIniciar.contains(ev.target) && !btnIniciar.contains(ev.target)) {
          menuIniciar.classList.remove("active");
          btnIniciar.classList.remove("active");
        }
      });



      // clique nos itens de "Links" do Menu Iniciar
      menuIniciar.addEventListener("click", ev => {
        const item = ev.target.closest(".itemIniciar[data-link]");
        if (!item) return;
        const href = item.getAttribute("data-link");
        if (!href) return;

        // fecha menu e navega
        menuIniciar.classList.remove("active");
        btnIniciar.classList.remove("active");
        window.location.href = href;
      });

      // clique nos ícones abre link
      document.addEventListener("click", ev => {
        const icon = ev.target.closest(".desktop-icon");
        if (!icon) return;
        const href = icon.dataset.link;
        if (href) {
          window.location.href = href;
        }
      });
    });
  </script>
</body>
</html>
