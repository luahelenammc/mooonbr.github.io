<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/x-icon" href="/images/pokeball.png">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meus Pok√©mons no P:GO</title>

  <style>
    :root{
      --bg1:#05060b;
      --bg2:#101522;
      --glass:#10131f;
      --stroke:rgba(255,255,255,.20);
      --text:#f7fbff;
      --muted:rgba(247,251,255,.76);
      --accent:#ee1515;
      --shadowDock:0 28px 80px rgba(0,0,0,.75);
      --radiusDock:26px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 0%, rgba(238,21,21,.22), transparent 60%),
        radial-gradient(1100px 800px at 90% 100%, rgba(42,117,187,.24), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
      display:flex;
      align-items:stretch;
      justify-content:center;
    }

    body::before{
      content:"";
      position:fixed;
      inset:-140px;
      pointer-events:none;
      opacity:.18;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.10) 0 2px, transparent 3px),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,.07) 0 2px, transparent 3px),
        radial-gradient(circle at 65% 75%, rgba(255,255,255,.09) 0 2px, transparent 3px),
        radial-gradient(circle at 28% 80%, rgba(255,255,255,.06) 0 2px, transparent 3px);
      filter:blur(.3px);
    }

    .wrap{
      position:relative;
      z-index:1;
      width:100%;
      max-width:1120px;
      padding:18px 14px 40px;
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .pokeball{
      width:46px;
      height:46px;
      border-radius:999px;
      background:
        linear-gradient(180deg,#ee1515 0 48%,#0b0b0b 48% 52%,#ffffff 52% 100%);
      border:2px solid rgba(255,255,255,.26);
      box-shadow:0 18px 40px rgba(0,0,0,.55);
      position:relative;
      flex:0 0 46px;
    }
    .pokeball::after{
      content:"";
      position:absolute;
      inset:17px;
      border-radius:999px;
      background:#ffffff;
      border:3px solid #0b0b0b;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.30);
    }

    h1{
      margin:0;
      font-size:clamp(22px,3.4vw,30px);
      letter-spacing:.3px;
    }

    .sub{
      margin:4px 0 0;
      font-size:13px;
      color:var(--muted);
    }

    .idbox{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(0,0,0,.45);
      box-shadow:0 14px 40px rgba(0,0,0,.55);
      font-size:13px;
      white-space:nowrap;
    }
    .pill strong{ font-weight:900; }

    .copy{
      appearance:none;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background:linear-gradient(135deg,rgba(238,21,21,.86),rgba(238,21,21,.55));
      color:#fff;
      padding:9px 14px;
      cursor:pointer;
      font-weight:900;
      box-shadow:0 16px 40px rgba(0,0,0,.65);
      font-size:13px;
    }
    .copy:hover{ filter:brightness(1.1); }
    .copy:active{ transform:translateY(1px); }

    .searchRow{
      display:flex;
      justify-content:center;
      margin-top:4px;
    }
    .search{
      width:min(520px,100%);
      border-radius:999px;
      border:1px solid rgba(255,255,255,.24);
      background:rgba(0,0,0,.55);
      color:var(--text);
      padding:11px 14px;
      outline:none;
      font-size:14px;
      box-shadow:0 18px 40px rgba(0,0,0,.55);
    }
    .search::placeholder{ color:rgba(247,251,255,.55); }

    .dockShell{
      margin-top:auto;
      display:flex;
      justify-content:center;
    }

    .dock{
      position:relative;
      width:100%;
      max-width:1040px;
      margin:0 auto;
      background:linear-gradient(135deg,rgba(15,17,27,.94),rgba(9,10,18,.98));
      border-radius:var(--radiusDock);
      border:1px solid rgba(255,255,255,.22);
      box-shadow:var(--shadowDock);
      padding:18px 12px 12px;
      backdrop-filter:blur(18px) saturate(140%);
      overflow:hidden;
    }

    .dock::before{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(900px 260px at 10% 0%,rgba(255,255,255,.14),transparent 60%);
      opacity:.35;
      pointer-events:none;
    }

    .dockGrid{
      position:relative;
      z-index:1;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }

    .card{
      position:relative;
      width:86px;
      padding:24px 4px 10px;
      border-radius:18px;
      background:linear-gradient(160deg,rgba(255,255,255,.06),rgba(0,0,0,.65));
      border:1px solid rgba(255,255,255,.18);
      box-shadow:0 18px 50px rgba(0,0,0,.75);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      transform-origin:50% 80%;
      transition:
        transform .16s ease-out,
        box-shadow .16s ease-out,
        background .16s ease-out,
        z-index .0s;
      cursor:default;
    }

    .card:hover{
      transform:scale(1.32) translateY(-8px);
      z-index:5;
      background:linear-gradient(150deg,rgba(255,255,255,.12),rgba(0,0,0,.50));
      box-shadow:0 26px 80px rgba(0,0,0,.85);
    }

    .ivTag{
      position:absolute;
      top:6px;
      left:50%;
      transform:translateX(-50%);
      padding:2px 7px;
      border-radius:999px;
      font-size:11px;
      font-variant-numeric:tabular-nums;
      letter-spacing:.3px;
      background:rgba(0,0,0,.72);
      border:1px solid rgba(255,255,255,.26);
      box-shadow:0 8px 20px rgba(0,0,0,.65);
      pointer-events:none;
    }

    .ivTag.good{ color:#93FE37; }
    .ivTag.mid{ color:#3CFFFF; }
    .ivTag.low{ color:#ffffff; }
    .ivTag.bad{ color:#ff5151; }

    .spriteShell{
      width:70px;
      height:70px;
      border-radius:16px;
      background:
        radial-gradient(30px 28px at 30% 18%,rgba(255,255,255,.30),transparent 60%),
        radial-gradient(52px 46px at 50% 72%,rgba(0,0,0,.55),rgba(0,0,0,.95));
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    .spriteShell img{
      display:block;
      width:auto;
      height:auto;
      max-width:64px;
      max-height:64px;
      image-rendering:pixelated;
    }

    .name{
      margin-top:1px;
      font-size:12px;
      font-weight:900;
      text-align:center;
      max-width:84px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .emojiRow{
      font-size:13px;
      text-align:center;
      opacity:.88;
    }

    .countTag{
      position:absolute;
      bottom:6px;
      right:6px;
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(0,0,0,.75);
      border:1px solid rgba(255,255,255,.26);
      box-shadow:0 8px 18px rgba(0,0,0,.75);
      opacity:.9;
    }

    @media (max-width:640px){
      .dock{
        padding-inline:10px;
        border-radius:22px;
      }
      .card{
        width:74px;
        padding-top:22px;
      }
      .spriteShell{
        width:62px;
        height:62px;
      }
      .spriteShell img{
        max-width:56px;
        max-height:56px;
      }
      .name{
        font-size:11px;
        max-width:72px;
      }
      .emojiRow{ font-size:12px; }
    }
  </style>
</head>
<body>
  <div class="wrap">

    <header>
      <div class="brand">
        <div class="pokeball" aria-hidden="true"></div>
        <div>
          <h1>Meus Pok√©mons</h1>
          <p class="sub"><strong>no Pok√©mon:GO</strong></p>
        </div>
      </div>

      <div class="idbox">
        <div class="pill">
          <span>Treinadora</span>
          <strong>LuaHMoonMC</strong>
        </div>
        <div class="pill">
          <span>C√≥digo</span>
          <strong id="friendCode">1612 5521 0803</strong>
        </div>
        <button class="copy" id="copyBtn" type="button">Copiar c√≥digo</button>
      </div>
    </header>

    <div class="searchRow">
      <input id="search" class="search" type="search" placeholder="Buscar pelo nome, ‚ú®, üéÑ, üí•‚Ä¶" autocomplete="off">
    </div>

    <div class="dockShell">
      <div class="dock">
        <div id="dockGrid" class="dockGrid"></div>
      </div>
    </div>

  </div>

<script type="module">
  import { RAW } from "./pokemon-data.js";

  const spriteGif = (slug, shiny=false) =>
    shiny
      ? `https://play.pokemonshowdown.com/sprites/xyani-shiny/${slug}.gif`
      : `https://play.pokemonshowdown.com/sprites/xyani/${slug}.gif`;

  const spritePng = (slug, shiny=false) =>
    shiny
      ? `https://play.pokemonshowdown.com/sprites/gen8-shiny/${slug}.png`
      : `https://play.pokemonshowdown.com/sprites/gen8/${slug}.png`;

  function prettyName(slug){
    if(!slug.includes("-")){
      return slug.charAt(0).toUpperCase() + slug.slice(1);
    }
    const parts = slug.split("-");
    const base = parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
    const form = parts.slice(1).join("-");

    if(form === "alola") return `${base} de Alola`;
    if(form === "galar") return `${base} de Galar`;
    if(form === "hisui") return `${base} de Hisui`;
    if(form === "mega")  return `Mega ${base}`;

    const formNice = form.replace(/\b\w/g, m => m.toUpperCase()).replace(/-/g," ");
    return `${base} (${formNice})`;
  }

  function displayName(p){
    const x = p.xmas ? " üéÑ" : "";
    const s = p.shiny ? " ‚ú®" : "";
    const d = p.dynamax ? " üí•" : "";
    return prettyName(p.name) + x + s + d;
  }

  function aggregate(raw){
    const map = new Map();

    for(const p of raw){
      const key = `${p.name}|${p.shiny ? 1 : 0}|${p.xmas ? 1 : 0}|${p.dynamax ? 1 : 0}`;

      if(!map.has(key)){
        map.set(key, {
          name: p.name,
          shiny: !!p.shiny,
          xmas: !!p.xmas,
          dynamax: !!p.dynamax,
          types: p.types || [],
          ivs: [p.iv ?? 0]
        });
      }else{
        map.get(key).ivs.push(p.iv ?? 0);
      }
    }

    const list = [];
    for(const v of map.values()){
      v.count = v.ivs.length;
      v.maxIv = Math.max(...v.ivs);
      v.ivsSorted = v.ivs.slice().sort((a,b)=>b-a);
      list.push(v);
    }

    list.sort((a,b)=>{
      if(b.maxIv !== a.maxIv) return b.maxIv - a.maxIv;
      if(!!b.shiny !== !!a.shiny) return (b.shiny ? 1 : 0) - (a.shiny ? 1 : 0);
      return displayName(a).localeCompare(displayName(b),"pt-BR",{sensitivity:"base"});
    });

    return list;
  }

  function ivClass(iv){
    if(iv >= 90) return "good";
    if(iv >= 80) return "mid";
    if(iv >= 60) return "low";
    return "bad";
  }

  function typeEmoji(type){
    switch(type){
      case "Grass":   return "üåø";
      case "Fire":    return "üî•";
      case "Water":   return "üíß";
      case "Electric":return "‚ö°";
      case "Psychic": return "üîÆ";
      case "Ghost":   return "üëª";
      case "Fairy":   return "‚ú®";
      case "Dark":    return "üåë";
      case "Steel":   return "‚öôÔ∏è";
      case "Ice":     return "‚ùÑÔ∏è";
      case "Dragon":  return "üêâ";
      case "Rock":    return "ü™®";
      case "Ground":  return "üåé";
      case "Flying":  return "üïäÔ∏è";
      case "Fighting":return "ü•ä";
      case "Poison":  return "‚ò†Ô∏è";
      case "Bug":     return "üêõ";
      case "Normal":  return "‚≠ê";
      default:        return "‚óΩ";
    }
  }

  function typesToEmoji(types){
    if(!types || !types.length) return "";
    const em = types.map(typeEmoji).join(" ");
    return em;
  }

  function wireSprite(img, slug, shiny){
    img.src = spriteGif(slug, shiny);
    img.onerror = () => {
      img.onerror = () => { img.src = spritePng(slug, false); };
      img.src = spritePng(slug, shiny);
    };
  }

  const AGG = aggregate(RAW);
  const dockGrid = document.getElementById("dockGrid");
  const search = document.getElementById("search");

  let query = "";

  function filtered(){
    let q = query.trim().toLowerCase();

    let wantsShiny = false;
    let wantsXmas = false;
    let wantsDyna = false;

    if(q.includes("‚ú®") || q.includes("shiny") || q.includes("brilhante")){
      wantsShiny = true;
      q = q.replaceAll("‚ú®","").replaceAll("shiny","").replaceAll("brilhante","").trim();
    }
    if(q.includes("üéÑ") || q.includes("xmas") || q.includes("natal")){
      wantsXmas = true;
      q = q.replaceAll("üéÑ","").replaceAll("xmas","").replaceAll("natal","").trim();
    }
    if(q.includes("üí•") || q.includes("dynamax") || q.includes("dyna")){
      wantsDyna = true;
      q = q.replaceAll("üí•","").replaceAll("dynamax","").replaceAll("dyna","").trim();
    }

    return AGG.filter(p=>{
      if(wantsShiny && !p.shiny) return false;
      if(wantsXmas && !p.xmas)   return false;
      if(wantsDyna && !p.dynamax)return false;

      if(!q) return true;

      const namePT = displayName(p).toLowerCase();
      const slug = p.name.toLowerCase();
      return namePT.includes(q) || slug.includes(q);
    });
  }

  function renderDock(){
    const list = filtered();
    dockGrid.innerHTML = "";

    list.forEach(p=>{
      const card = document.createElement("div");
      card.className = "card";

      const ivTag = document.createElement("div");
      ivTag.className = "ivTag " + ivClass(p.maxIv);
      ivTag.textContent = p.maxIv;
      card.appendChild(ivTag);

      const shell = document.createElement("div");
      shell.className = "spriteShell";

      const img = document.createElement("img");
      img.loading = "lazy";
      img.alt = p.shiny ? `${p.name} shiny` : p.name;
      wireSprite(img, p.name, p.shiny);
      shell.appendChild(img);

      card.appendChild(shell);

      const nm = document.createElement("div");
      nm.className = "name";
      nm.textContent = displayName(p);
      card.appendChild(nm);

      const emojiRow = document.createElement("div");
      emojiRow.className = "emojiRow";
      emojiRow.textContent = typesToEmoji(p.types || []);
      card.appendChild(emojiRow);

      if(p.count > 1){
        const countTag = document.createElement("div");
        countTag.className = "countTag";
        countTag.textContent = `√ó${p.count}`;
        card.appendChild(countTag);
      }

      dockGrid.appendChild(card);
    });
  }

  search.addEventListener("input", ()=>{
    query = search.value || "";
    renderDock();
  });

  const copyBtn = document.getElementById("copyBtn");
  copyBtn.addEventListener("click", async ()=>{
    const code = document.getElementById("friendCode").textContent.replace(/\s+/g," ").trim();
    const old = copyBtn.textContent;
    try{
      await navigator.clipboard.writeText(code);
      copyBtn.textContent = "Copiado ‚úÖ";
      setTimeout(()=> copyBtn.textContent = old, 1100);
    }catch{
      copyBtn.textContent = "Selecionei ‚ú®";
      setTimeout(()=> copyBtn.textContent = old, 1100);
    }
  });

  renderDock();
</script>

</body>
</html>
