<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pok√©mon GO ‚Ä¢ LuaHMoonMC</title>

  <style>
    :root{
      --bg1:#05060b;
      --bg2:#101522;
      --glass:#10131f;
      --stroke:rgba(255,255,255,.20);
      --text:#f7fbff;
      --muted:rgba(247,251,255,.76);
      --accent:#ee1515;
      --accentSoft:rgba(238,21,21,.25);
      --shadowDock:0 28px 80px rgba(0,0,0,.75);
      --radiusDock:26px;
    }

    *{ box-sizing:border-box; }
html{ min-height:100%; }

body{
  min-height:100vh;
  height:auto;
  align-items:flex-start; /* em vez de stretch */
}

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 0%, rgba(238,21,21,.22), transparent 60%),
        radial-gradient(1100px 800px at 90% 100%, rgba(42,117,187,.24), transparent 60%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
      display:flex;
      align-items:stretch;
      justify-content:center;
    }

    body::before{
      content:"";
      position:fixed;
      inset:-140px;
      pointer-events:none;
      opacity:.18;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.10) 0 2px, transparent 3px),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,.07) 0 2px, transparent 3px),
        radial-gradient(circle at 65% 75%, rgba(255,255,255,.09) 0 2px, transparent 3px),
        radial-gradient(circle at 28% 80%, rgba(255,255,255,.06) 0 2px, transparent 3px);
      filter:blur(.3px);
    }

    .wrap{
      position:relative;
      z-index:1;
      width:100%;
      max-width:1120px;
      padding:18px 14px 40px;
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .pokeball{
      width:46px;
      height:46px;
      border-radius:999px;
      background:
        linear-gradient(180deg,#ee1515 0 48%,#0b0b0b 48% 52%,#ffffff 52% 100%);
      border:2px solid rgba(255,255,255,.26);
      box-shadow:0 18px 40px rgba(0,0,0,.55);
      position:relative;
      flex:0 0 46px;
    }
    .pokeball::after{
      content:"";
      position:absolute;
      inset:17px;
      border-radius:999px;
      background:#ffffff;
      border:3px solid #0b0b0b;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.30);
    }

    h1{
      margin:0;
      font-size:clamp(22px,3.4vw,30px);
      letter-spacing:.3px;
    }

    .sub{
      margin:4px 0 0;
      font-size:13px;
      color:var(--muted);
    }

    .idbox{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(0,0,0,.45);
      box-shadow:0 14px 40px rgba(0,0,0,.55);
      font-size:13px;
      white-space:nowrap;
    }
    .pill strong{ font-weight:900; }

    .copy{
      appearance:none;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background:linear-gradient(135deg,rgba(238,21,21,.86),rgba(238,21,21,.55));
      color:#fff;
      padding:9px 14px;
      cursor:pointer;
      font-weight:900;
      box-shadow:0 16px 40px rgba(0,0,0,.65);
      font-size:13px;
    }
    .copy:hover{ filter:brightness(1.1); }
    .copy:active{ transform:translateY(1px); }

    .searchRow{
      display:flex;
      justify-content:center;
      margin-top:4px;
    }
    .search{
      width:min(520px,100%);
      border-radius:999px;
      border:1px solid rgba(255,255,255,.24);
      background:rgba(0,0,0,.55);
      color:var(--text);
      padding:11px 14px;
      outline:none;
      font-size:14px;
      box-shadow:0 18px 40px rgba(0,0,0,.55);
    }
    .search::placeholder{ color:rgba(247,251,255,.55); }

  /* =========================
   TAGS (Todos / Shiny / Natal / Dynamax)
   ========================= */

.tagRow{
  display:flex;
  gap:10px;
  justify-content:center;
  align-items:center;
  flex-wrap:wrap;
  margin: 6px 0 10px;
}

/* bot√£o ‚Äúp√≠lula‚Äù das tags especiais */
.tagBtn{
  appearance:none;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.26);
  color: rgba(255,255,255,.92);
  padding: 8px 14px;
  border-radius: 999px;
  font-weight: 800;
  font-size: 13px;
  letter-spacing: .2px;
  cursor: pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  box-shadow:
    0 10px 20px rgba(0,0,0,.28),
    inset 0 1px 0 rgba(255,255,255,.10);
  transition: transform .12s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
}

.tagBtn:hover{
  transform: translateY(-1px);
  border-color: rgba(255,255,255,.24);
  background: rgba(0,0,0,.34);
}

.tagBtn:active{
  transform: translateY(0px) scale(.99);
}

/* estado ativo (quando o filtro est√° selecionado) */
.tagBtn.active{
  background: linear-gradient(180deg, rgba(238,21,21,.35), rgba(238,21,21,.14));
  border-color: rgba(238,21,21,.55);
  box-shadow:
    0 14px 28px rgba(238,21,21,.18),
    inset 0 1px 0 rgba(255,255,255,.14);
}


/* =========================
   TIPOS (Normal / Fogo / √Ågua / etc.)
   ========================= */

.typeRow{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
  align-items:center;
  margin: 6px 0 12px;
}

/* bot√£o redondinho de tipo */
.typeBtn{
  appearance:none;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: rgba(255,255,255,.88);
  padding: 7px 12px;
  border-radius: 999px;
  font-weight: 800;
  font-size: 12px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  box-shadow:
    0 8px 18px rgba(0,0,0,.22),
    inset 0 1px 0 rgba(255,255,255,.08);
  transition: transform .12s ease, background .18s ease, border-color .18s ease;
}

.typeBtn:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.09);
  border-color: rgba(255,255,255,.22);
}

.typeBtn.active{
  background: rgba(42,117,187,.22);
  border-color: rgba(42,117,187,.55);
}

/* opcional: visual do bot√£o ‚ÄúTIPOS‚Äù (t√≠tulo) se voc√™ usa um */
.typeBtn.isLabel{
  cursor: default;
  opacity: .85;
  background: rgba(0,0,0,.22);
  border-color: rgba(255,255,255,.12);
}


    .statsRow{
      margin:10px auto 4px;
      display:ruby;
      flex-wrap:wrap;
      gap:14px;
      justify-content:center;
      max-width:720px;
    }
    .statBlock{
      flex:1 1 260px;
      max-width:330px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.26);
      background:
        radial-gradient(600px 280px at 0 0, rgba(255,255,255,.12), transparent 60%),
        linear-gradient(145deg,rgba(0,0,0,.78),rgba(0,0,0,.96));
      box-shadow:0 20px 50px rgba(0,0,0,.7);
      padding:10px 14px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
      margin: 5px 5px;
    }
    .statLabel{
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:rgba(247,251,255,.8);
    }
    .flipDigits{
      display:flex;
      gap:4px;
      margin-top:4px;
    }
    .digitStat{
      position:relative;
      width:40px;
      height:56px;
      border-radius:10px;
      filter:drop-shadow(0 10px 24px rgba(0,0,0,.7));
      overflow:hidden;
    }
    .digitFace{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.7rem;
      font-weight:900;
      font-variant-numeric:tabular-nums;
      color:var(--text);
      background:
        radial-gradient(140% 90% at 50% 0%, rgba(255,255,255,.16), transparent 60%),
        linear-gradient(180deg,#1b2028,#12151b 52%,#0a0c11 100%),
        repeating-linear-gradient(90deg,rgba(255,255,255,.06) 0 1px,rgba(255,255,255,0) 1px 4px);
      border:1px solid rgba(255,255,255,.24);
      box-shadow:
        inset 0 14px 28px rgba(255,255,255,.06),
        inset 0 -18px 36px rgba(0,0,0,.78),
        inset 0 0 0 1px rgba(0,0,0,.7),
        0 0 0 2px color-mix(in oklab,var(--accent) 24%,transparent);
    }
    .digitFace::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:10px;
      background:
        linear-gradient(180deg,transparent calc(50% - 1px),rgba(255,255,255,.12) 50%,rgba(0,0,0,.7) calc(50% + 1px),transparent calc(50% + 2px));
      pointer-events:none;
    }

    .dockShell{
      margin-top:auto;
      display:flex;
      justify-content:center;
    }

    .dock{
      position:relative;
      width:100%;
      max-width:1040px;
      margin:0 auto;
      background:linear-gradient(135deg,rgba(15,17,27,.94),rgba(9,10,18,.98));
      border-radius:var(--radiusDock);
      border:1px solid rgba(255,255,255,.22);
      box-shadow:var(--shadowDock);
      padding:18px 12px 12px;
      backdrop-filter:blur(18px) saturate(140%);
      overflow:hidden;
    }

    .dock::before{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(900px 260px at 10% 0%,rgba(255,255,255,.14),transparent 60%);
      opacity:.35;
      pointer-events:none;
    }

    .dockGrid{
      position:relative;
      z-index:1;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }

    .card{
      position:relative;
      width:86px;
      padding:24px 4px 10px;
      border-radius:18px;
      background:linear-gradient(160deg,rgba(255,255,255,.06),rgba(0,0,0,.65));
      border:1px solid rgba(255,255,255,.18);
      box-shadow:0 18px 50px rgba(0,0,0,.75);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      transform-origin:50% 80%;
      transition:
        transform .16s ease-out,
        box-shadow .16s ease-out,
        background .16s ease-out,
        z-index .0s;
      cursor:default;
    }

    .card:hover{
      transform:scale(1.32) translateY(-8px);
      z-index:5;
      background:linear-gradient(150deg,rgba(255,255,255,.12),rgba(0,0,0,.50));
      box-shadow:0 26px 80px rgba(0,0,0,.85);
    }

    .ivTag{
      position:absolute;
      top:6px;
      left:50%;
      transform:translateX(-50%);
      padding:2px 7px;
      border-radius:999px;
      font-size:11px;
      font-variant-numeric:tabular-nums;
      letter-spacing:.3px;
      background:rgba(0,0,0,.72);
      border:1px solid rgba(255,255,255,.26);
      box-shadow:0 8px 20px rgba(0,0,0,.65);
      pointer-events:none;
    }
    
.ivLabel{
  color:#fff;
  opacity:.95;
  font-weight:900;
  margin-right:6px;
}
.ivNum{ color:inherit; }

    
    .ivTag.good{ color:#93FE37; }
    .ivTag.mid{ color:#3CFFFF; }
    .ivTag.low{ color:#ffffff; }
    .ivTag.bad{ color:#ff5151; }

    .spriteShell{
      width:70px;
      height:70px;
      border-radius:16px;
      background:
        radial-gradient(30px 28px at 30% 18%,rgba(255,255,255,.30),transparent 60%),
        radial-gradient(52px 46px at 50% 72%,rgba(0,0,0,.55),rgba(0,0,0,.95));
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    .spriteShell img{
      display:block;
      width:auto;
      height:auto;
      max-width:64px;
      max-height:64px;
      image-rendering:pixelated;
    }

    .name{
      margin-top:1px;
      font-size:12px;
      font-weight:900;
      text-align:center;
      max-width:84px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .emojiRow{
      font-size:13px;
      text-align:center;
      opacity:.88;
    }

    .countTag{
      position:absolute;
      bottom:6px;
      right:6px;
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(0,0,0,.75);
      border:1px solid rgba(255,255,255,.26);
      box-shadow:0 8px 18px rgba(0,0,0,.75);
      opacity:.9;
    }

    @media (max-width:640px){
      .dock{
        padding-inline:10px;
        border-radius:22px;
      }
      .card{
        width:74px;
        padding-top:22px;
      }
      .spriteShell{
        width:62px;
        height:62px;
      }
      .spriteShell img{
        max-width:56px;
        max-height:56px;
      }
      .name{
        font-size:11px;
        max-width:72px;
      }
      .emojiRow{ font-size:12px; }
      .digitStat{
        width:34px;
        height:50px;
      }
    }

      .lastUpdated{
    margin: 14px auto 0;
    text-align:center;
    font-size: 12px;
    letter-spacing:.06em;
    color: rgba(247,251,255,.70);
    opacity:.95;
  }
  </style>
</head>
<body>
  <div class="wrap">

    <header>
      <div class="brand">
        <div class="pokeball" aria-hidden="true"></div>
        <div>
          <h1>Meus Pok√©mons</h1>
          <p class="sub">no Pok√©mon GO</p>
        </div>
      </div>

      <div class="idbox">
        <div class="pill">
          <span>Treinadora</span>
          <strong>LuaHMoonMC</strong>
        </div>
        <div class="pill">
          <span>C√≥digo</span>
          <strong id="friendCode">1612 5521 0803</strong>
        </div>
        <button class="copy" id="copyBtn" type="button">Copiar c√≥digo</button>
      </div>
    </header>

    <div class="searchRow">
      <input id="search" class="search" type="search" placeholder="Buscar pelo nome, ‚ú®, üéÑ, üí•‚Ä¶" autocomplete="off">
    </div>

   <div class="tagRow">
  <button class="tagBtn active" data-tag="all">Todos</button>
  <button class="tagBtn" data-tag="shiny">‚ú® Shiny</button>
  <button class="tagBtn" data-tag="xmas">üéÑ Natal</button>
  <button class="tagBtn" data-tag="dynamax">üí• Dynamax</button>
</div>

<div class="typeRow">
  <button class="typeBtn isLabel" type="button">TIPOS</button>

  <button class="typeBtn active" data-type="all" type="button">Todos</button>

  <button class="typeBtn" data-type="Normal" type="button">‚≠ê Normal</button>
  <button class="typeBtn" data-type="Fire" type="button">üî• Fogo</button>
  <button class="typeBtn" data-type="Water" type="button">üíß √Ågua</button>
  <button class="typeBtn" data-type="Electric" type="button">‚ö° El√©trico</button>
  <button class="typeBtn" data-type="Grass" type="button">üåø Planta</button>
  <button class="typeBtn" data-type="Ice" type="button">‚ùÑÔ∏è Gelo</button>
  <button class="typeBtn" data-type="Fighting" type="button">ü•ä Lutador</button>
  <button class="typeBtn" data-type="Poison" type="button">‚ò†Ô∏è Veneno</button>
  <button class="typeBtn" data-type="Ground" type="button">üåç Terrestre</button>
  <button class="typeBtn" data-type="Flying" type="button">ü™Ω Voador</button>
  <button class="typeBtn" data-type="Psychic" type="button">üîÆ Ps√≠quico</button>
  <button class="typeBtn" data-type="Bug" type="button">üêõ Inseto</button>
  <button class="typeBtn" data-type="Rock" type="button">ü™® Pedra</button>
  <button class="typeBtn" data-type="Ghost" type="button">üëª Fantasma</button>
  <button class="typeBtn" data-type="Dragon" type="button">üêâ Drag√£o</button>
  <button class="typeBtn" data-type="Dark" type="button">üåë Sombrio</button>
  <button class="typeBtn" data-type="Steel" type="button">‚öôÔ∏è A√ßo</button>
  <button class="typeBtn" data-type="Fairy" type="button">üßö Fada</button>
</div>

    

    <div class="dockShell">
      <div class="dock">
        <div id="dockGrid" class="dockGrid"></div>
      </div>
    </div>

    <div class="statsRow">
      <div class="statBlock">
        <div class="statLabel">Gin√°sios derrotados</div>
        <div class="flipDigits" id="gymsDefeated"></div>
      </div>
      <div class="statBlock">
        <div class="statLabel">Horas liderando gin√°sios</div>
        <div class="flipDigits" id="hoursLeader"></div>
      </div>
    </div>

    <div id="lastUpdated" class="lastUpdated"></div>

    
  </div>

<script type="module">
  import { RAW, GYM_STATS, META } from "./pokemon-data.js";


  const spriteGif = (slug, shiny=false) =>
    shiny
      ? `https://play.pokemonshowdown.com/sprites/xyani-shiny/${slug}.gif`
      : `https://play.pokemonshowdown.com/sprites/xyani/${slug}.gif`;

  const spritePng = (slug, shiny=false) =>
    shiny
      ? `https://play.pokemonshowdown.com/sprites/gen8-shiny/${slug}.png`
      : `https://play.pokemonshowdown.com/sprites/gen8/${slug}.png`;

  function prettyName(slug){
    if(!slug.includes("-")){
      return slug.charAt(0).toUpperCase() + slug.slice(1);
    }
    const parts = slug.split("-");
    const base = parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
    const form = parts.slice(1).join("-");

    if(form === "alola") return `${base} de Alola`;
    if(form === "galar") return `${base} de Galar`;
    if(form === "hisui") return `${base} de Hisui`;
    if(form === "mega")  return `Mega ${base}`;

    const formNice = form.replace(/\b\w/g, m => m.toUpperCase()).replace(/-/g," ");
    return `${base} (${formNice})`;
  }

  function displayName(p){
    const x = p.xmas ? " üéÑ" : "";
    const s = p.shiny ? " ‚ú®" : "";
    const d = p.dynamax ? " üí•" : "";
    return prettyName(p.name) + x + s + d;
  }

  function aggregate(raw){
    const map = new Map();

    for(const p of raw){
      const key = `${p.name}|${p.shiny ? 1 : 0}|${p.xmas ? 1 : 0}|${p.dynamax ? 1 : 0}`;

      if(!map.has(key)){
        map.set(key, {
          name: p.name,
          shiny: !!p.shiny,
          xmas: !!p.xmas,
          dynamax: !!p.dynamax,
          types: p.types || [],
          ivs: [p.iv ?? 0]
        });
      }else{
        map.get(key).ivs.push(p.iv ?? 0);
      }
    }

    const list = [];
    for(const v of map.values()){
      v.count = v.ivs.length;
      v.maxIv = Math.max(...v.ivs);
      v.ivsSorted = v.ivs.slice().sort((a,b)=>b-a);
      list.push(v);
    }

    list.sort((a,b)=>{
      if(b.maxIv !== a.maxIv) return b.maxIv - a.maxIv;
      if(!!b.shiny !== !!a.shiny) return (b.shiny ? 1 : 0) - (a.shiny ? 1 : 0);
      return displayName(a).localeCompare(displayName(b),"pt-BR",{sensitivity:"base"});
    });

    return list;
  }

  function ivClass(iv){
    if(iv >= 90) return "good";
    if(iv >= 80) return "mid";
    if(iv >= 60) return "low";
    return "bad";
  }

  function typeEmoji(type){
    switch(type){
      case "Grass":   return "üåø";
      case "Fire":    return "üî•";
      case "Water":   return "üíß";
      case "Electric":return "‚ö°";
      case "Psychic": return "üîÆ";
      case "Ghost":   return "üëª";
      case "Fairy":   return "‚ú®";
      case "Dark":    return "üåë";
      case "Steel":   return "‚öôÔ∏è";
      case "Ice":     return "‚ùÑÔ∏è";
      case "Dragon":  return "üêâ";
      case "Rock":    return "ü™®";
      case "Ground":  return "üåé";
      case "Flying":  return "üïäÔ∏è";
      case "Fighting":return "ü•ä";
      case "Poison":  return "‚ò†Ô∏è";
      case "Bug":     return "üêõ";
      case "Normal":  return "‚≠ê";
      default:        return "‚óΩ";
    }
  }

  function typesToEmoji(types){
    if(!types || !types.length) return "";
    return types.map(typeEmoji).join(" ");
  }

  function wireSprite(img, slug, shiny){
    img.src = spriteGif(slug, shiny);
    img.onerror = () => {
      img.onerror = () => { img.src = spritePng(slug, false); };
      img.src = spritePng(slug, shiny);
    };
  }

  const AGG = aggregate(RAW);
  const dockGrid = document.getElementById("dockGrid");
  const search = document.getElementById("search");

  const tagState = {
    shiny:false,
    xmas:false,
    dynamax:false
  };

  const typeState = new Set(); // guarda tipos selecionados (em ingl√™s, igual no data.js)

const TYPE_META = [
  { type:"Normal",   pt:"Normal",   color:"#A8A878" },
  { type:"Fire",     pt:"Fogo",     color:"#F08030" },
  { type:"Water",    pt:"√Ågua",     color:"#6890F0" },
  { type:"Electric", pt:"El√©trico", color:"#F8D030" },
  { type:"Grass",    pt:"Planta",   color:"#78C850" },
  { type:"Ice",      pt:"Gelo",     color:"#98D8D8" },
  { type:"Fighting", pt:"Lutador",  color:"#C03028" },
  { type:"Poison",   pt:"Veneno",   color:"#A040A0" },
  { type:"Ground",   pt:"Terra",    color:"#E0C068" },
  { type:"Flying",   pt:"Voador",   color:"#A890F0" },
  { type:"Psychic",  pt:"Ps√≠quico", color:"#F85888" },
  { type:"Bug",      pt:"Inseto",   color:"#A8B820" },
  { type:"Rock",     pt:"Pedra",    color:"#B8A038" },
  { type:"Ghost",    pt:"Fantasma", color:"#705898" },
  { type:"Dragon",   pt:"Drag√£o",   color:"#7038F8" },
  { type:"Dark",     pt:"Sombrio",  color:"#705848" },
  { type:"Steel",    pt:"A√ßo",      color:"#B8B8D0" },
  { type:"Fairy",    pt:"Fada",     color:"#EE99AC" },
];

function setupTypeFilters(){
  const row = document.querySelector(".typeRow"); // <- era getElementById
  if(!row) return;

  const allBtn = row.querySelector('.typeBtn[data-type="all"]');

  row.addEventListener("click", (ev)=>{
    const btn = ev.target.closest(".typeBtn");
    if(!btn || btn.classList.contains("isLabel")) return;

    const tp = btn.dataset.type;

    if(tp === "all"){
      typeState.clear();
      row.querySelectorAll('.typeBtn[data-type]').forEach(b=>b.classList.remove("active"));
      allBtn?.classList.add("active");
      renderDock();
      return;
    }

    allBtn?.classList.remove("active");

    btn.classList.toggle("active");
    if(btn.classList.contains("active")) typeState.add(tp);
    else typeState.delete(tp);

    if(typeState.size === 0) allBtn?.classList.add("active");

    renderDock();
  });
}



  function filtered(){
    let q = (search.value || "").trim().toLowerCase();

    let wantsShiny = false;
    let wantsXmas  = false;
    let wantsDyna  = false;

    if(q.includes("‚ú®") || q.includes("shiny") || q.includes("brilhante")){
      wantsShiny = true;
      q = q.replaceAll("‚ú®","").replaceAll("shiny","").replaceAll("brilhante","").trim();
    }
    if(q.includes("üéÑ") || q.includes("xmas") || q.includes("natal")){
      wantsXmas = true;
      q = q.replaceAll("üéÑ","").replaceAll("xmas","").replaceAll("natal","").trim();
    }
    if(q.includes("üí•") || q.includes("dynamax") || q.includes("dyna")){
      wantsDyna = true;
      q = q.replaceAll("üí•","").replaceAll("dynamax","").replaceAll("dyna","").trim();
    }

    wantsShiny = wantsShiny || tagState.shiny;
    wantsXmas  = wantsXmas  || tagState.xmas;
    wantsDyna  = wantsDyna  || tagState.dynamax;

  return AGG.filter(p=>{
  if(wantsShiny && !p.shiny)   return false;
  if(wantsXmas  && !p.xmas)    return false;
  if(wantsDyna  && !p.dynamax) return false;

  // NOVO: filtro por tipo (OR: se selecionou v√°rios, basta bater em um)
  if(typeState.size){
    const types = p.types || [];
    if(!types.some(t => typeState.has(t))) return false;
  }

  if(!q) return true;

  const namePT = displayName(p).toLowerCase();
  const slug = p.name.toLowerCase();
  return namePT.includes(q) || slug.includes(q);
});

  }

  function renderDock(){
    const list = filtered();
    dockGrid.innerHTML = "";

    list.forEach(p=>{
      const card = document.createElement("div");
      card.className = "card";

      const ivTag = document.createElement("div");
      ivTag.className = "ivTag " + ivClass(p.maxIv);
ivTag.innerHTML = `<span class="ivLabel">IV</span><span class="ivNum">${p.maxIv}</span>`;
      card.appendChild(ivTag);

      const shell = document.createElement("div");
      shell.className = "spriteShell";

      const img = document.createElement("img");
      img.loading = "lazy";
      img.alt = p.shiny ? `${p.name} shiny` : p.name;
      wireSprite(img, p.name, p.shiny);
      shell.appendChild(img);

      card.appendChild(shell);

      const nm = document.createElement("div");
      nm.className = "name";
      nm.textContent = displayName(p);
      card.appendChild(nm);

      const emojiRow = document.createElement("div");
      emojiRow.className = "emojiRow";
      emojiRow.textContent = typesToEmoji(p.types || []);
      card.appendChild(emojiRow);

      if(p.count > 1){
        const countTag = document.createElement("div");
        countTag.className = "countTag";
        countTag.textContent = `√ó${p.count}`;
        card.appendChild(countTag);
      }

      dockGrid.appendChild(card);
    });
  }

function renderFlipStat(id, value, minDigits){
  const el = document.getElementById(id);
  if(!el) return;

  const raw = String(value ?? 0);
  const padded = (minDigits ? raw.padStart(minDigits,"0") : raw);

  // remove zeros √† esquerda, mas mant√©m pelo menos 1 d√≠gito
  const s = padded.replace(/^0+(?=\d)/, "");

  el.innerHTML = "";
  for(const ch of s){
    const d = document.createElement("div");
    d.className = "digitStat";
    const face = document.createElement("div");
    face.className = "digitFace";
    face.textContent = ch;
    d.appendChild(face);
    el.appendChild(d);
  }
}


  function renderStats(){
    const gyms = GYM_STATS?.gymsDefeated ?? 0;
    const mins = GYM_STATS?.hoursLeading ?? 0;
    renderFlipStat("gymsDefeated", gyms, 7);
    renderFlipStat("hoursLeading", hours, 5);
  }

  function setupTagFilters(){
    const btns = document.querySelectorAll(".tagBtn");
    const allBtn = document.querySelector('.tagBtn[data-tag="all"]');

    btns.forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const tag = btn.dataset.tag;
        if(tag === "all"){
          tagState.shiny = tagState.xmas = tagState.dynamax = false;
          btns.forEach(b=>b.classList.remove("active"));
          allBtn.classList.add("active");
        }else{
          const isActive = btn.classList.toggle("active");
          if(tag === "shiny")   tagState.shiny   = isActive;
          if(tag === "xmas")    tagState.xmas    = isActive;
          if(tag === "dynamax") tagState.dynamax = isActive;

          if(tagState.shiny || tagState.xmas || tagState.dynamax){
            allBtn.classList.remove("active");
          }else{
            allBtn.classList.add("active");
          }
        }
        renderDock();
      });
    });
  }

  search.addEventListener("input", ()=>{
    renderDock();
  });

  const copyBtn = document.getElementById("copyBtn");
  copyBtn.addEventListener("click", async ()=>{
    const code = document.getElementById("friendCode").textContent.replace(/\s+/g," ").trim();
    const old = copyBtn.textContent;
    try{
      await navigator.clipboard.writeText(code);
      copyBtn.textContent = "Copiado ‚úÖ";
      setTimeout(()=> copyBtn.textContent = old, 1100);
    }catch{
      copyBtn.textContent = "Selecionei ‚ú®";
      setTimeout(()=> copyBtn.textContent = old, 1100);
    }
  });



  function formatBR(iso){
  if(!iso) return "??/??/??";
  // aceita "2026-01-01"
  const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(iso);
  if(m) return `${m[3]}/${m[2]}/${m[1].slice(2)}`; // DD/MM/AA
  return iso; // se voc√™ j√° mandar "01/01/26", ele mostra como vier
}

function renderLastUpdated(){
  const el = document.getElementById("lastUpdated");
  if(!el) return;
  el.textContent = `Atualizado pela √∫ltima vez em ${formatBR(META?.lastUpdated)}`;
}

setupTagFilters();
setupTypeFilters();   // <- faltava
renderStats();
renderLastUpdated();
renderDock();

</script>

</body>
</html>
