<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>MoonTunes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* …todo o seu CSS permanece inalterado… */
    /* iTunes stripes */
    tbody tr:nth-child(odd)  { background:#fff; }
    tbody tr:nth-child(even) { background:#f7f7f7; }
  </style>
</head>
<body>
  <div class="window">
    <header class="toolbar">
      <div class="lights">…</div>
      <h1>MoonTunes</h1>
      <input id="search-box" type="search" placeholder="Buscar" />
    </header>
    <div class="wrapper">
      <nav id="sidebar"></nav>
      <section id="main">
        <table>
          <thead><tr><th>#</th><th></th><th>Música</th><th>Artista</th></tr></thead>
          <tbody id="track-body"></tbody>
        </table>
      </section>
    </div>
  </div>

  <script>
    const API_KEY = "YOUR_API_KEY_HERE"; // sua YouTube Data API v3
    const library = {
      "INFÂNCIA":[ /* …todas as faixas… */ ],
      "ADOLESCÊNCIA":[ /* … */ ],
      "HABBO":[ /* … */ ],
      "VIAGEM AOS EUA":[ /* … */ ],
      "SOFRÊNCIA AMOROSA":[ /* … */ ]
    };

    const sidebar = document.getElementById("sidebar"),
          tbody   = document.getElementById("track-body"),
          search  = document.getElementById("search-box");
    let current = [];

    Object.keys(library).forEach((name,i)=>{
      const div = document.createElement("div");
      div.className = "playlist"+(i===0?" active":"");
      div.textContent = name;
      div.onclick = ()=>{
        document.querySelectorAll(".playlist").forEach(p=>p.classList.remove("active"));
        div.classList.add("active");
        load(name);
      };
      sidebar.appendChild(div);
    });

    function load(name){
      tbody.innerHTML = "";
      current = library[name].map((s,i)=>buildRow(i+1,s));
      current.forEach(r=>tbody.appendChild(r));
    }

    function buildRow(n,str){
      const [title,artist] = str.split(" - "),
            query = encodeURIComponent(title+" "+(artist||"")),
            // fallback: leva à busca, garante que href nunca seja "#"
            fallbackUrl = `https://www.youtube.com/results?search_query=${query}`,
            btn = document.createElement("a");

      btn.className = "ybtn";
      btn.title = "Abrir primeiro vídeo no YouTube";
      btn.href  = fallbackUrl;      // usa busca até API responder
      btn.target = "_blank";

      // busca o vídeo “lucky” e sobrescreve href
      fetch(`https://www.googleapis.com/youtube/v3/search?key=${API_KEY}`
          +`&part=id&type=video&maxResults=1&q=${query}`)
        .then(r=>r.json())
        .then(json=>{
          const vid = json.items?.[0]?.id?.videoId;
          if(vid){
            btn.href = `https://www.youtube.com/watch?v=${vid}`;
          }
        })
        .catch(console.error);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${n}</td>
        <td></td>
        <td>${title.trim()}</td>
        <td>${artist?artist.trim():""}</td>`;
      tr.children[1].appendChild(btn);

      tr.onclick = e=>{
        if(e.target.closest(".ybtn")) return;
        document.querySelectorAll("tbody tr").forEach(r=>r.classList.remove("selected"));
        tr.classList.add("selected");
      };
      return tr;
    }

    search.addEventListener("input",()=>{
      const q = search.value.toLowerCase();
      current.forEach(r=> r.style.display = r.innerText.toLowerCase().includes(q) ? "table-row":"none");
    });

    load(Object.keys(library)[0]);
  </script>
</body>
</html>
